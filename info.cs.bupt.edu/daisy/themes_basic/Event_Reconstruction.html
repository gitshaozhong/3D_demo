<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0076)https://aladdin1.inf.cs.cmu.edu/daisy/index.php/application/cPointCloudVideo -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0">
	<link rel="stylesheet" type="text/css" href="js/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="js/datepicker.css">
	<link rel="stylesheet" type="text/css" href="js/bootstrap-datetimepicker.min.css">
	<link rel="stylesheet" type="text/css" href="js/cssReset.css">
    <script language="javascript" src="js/jquery.min.js"></script>
	<script language="javascript" src="js/bootstrap.min.js"></script>
	<script language="javascript" src="js/jquery.mobile.touch.min.js"></script>
	<script language="javascript" src="js/bootstrap-datepicker.js"></script>
	<script language="javascript" src="js/bootstrap-datetimepicker.min.js"></script>
	<script language="javascript" src="js/bootstrap-datepicker.zh-CN.js"></script>
	<script language="javascript" src="js/bootstrap-datetimepicker.zh-CN.js"></script>
		<script language="javascript" src="js/basic.js"></script>
	<title>事件重构</title>
<style type="text/css">.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1!important}.dg.main .close-button.drag,.dg.main:hover .close-button{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;transition:opacity .1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save>ul{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height .1s ease-out;transition:height .1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid transparent}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.boolean,.dg .cr.boolean *,.dg .cr.function,.dg .cr.function *,.dg .cr.function .property-name{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco,monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px Lucida Grande,sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid hsla(0,0%,100%,.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.boolean:hover,.dg .cr.function:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}</style><span></span></head>
<body id="bodyTop">
<style type="text/css">
	body{
		background-color:rgb(220,220,220);
		font-family:"Microsoft YaHei",微软雅黑,宋体,Helvetica,arial;
	}
	.modal-backdrop{
		/*fixed ie7*/
		*+display:none;
	}

</style>


<style type="text/css">
	#siteHeader{
		background-color:rgb(0,128,192);
		height:30px;
		padding:5px 0px;

		width:100%;
		-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;
	}
	div.makeupspace{
		height:30px;
		padding:5px 0;
		width:100%;
		position:relative;
	}
	#siteHeader > a.logo{
		position:absolute;
		left:50%;
		width:300px;
		text-align:center;
		margin-left:-150px;
		font-size:1.2em;
		font-weight:bold;
		padding-top:5px;
		color:white;
		text-decoration:none;
		outline:none;
	}
	#siteHeader > a.logo:focus{
		outline:none;
	}
	#siteHeader > span.loading{
		position:absolute;
		left:50%;
		width:20px;
		margin-left:52px;
		font-size:1.2em;
		font-weight:bold;
		padding-top:5px;
		color:white;
	}

	#siteHeader > div.header-button,
	#siteHeader > div.back{
		float:left;
		padding:5px 10px;
		cursor:pointer;
		margin-right:5px;
		margin-left:5px;
		height:20px;
		background-color:rgb(105,196,211);
		border-radius:3px;
		position:relative;
	}
	#siteHeader > div.back{
		background-color:transparent;
		padding:8px;
		padding-left:0;
		padding-bottom:0px;
		display:none;
	}
	#siteHeader > div.header-button:hover{
		background-color:rgb(105,196,231);
	}
	#siteHeader > div.header-button > span{
		color:white;
		font-size:0.8em;
		font-weight:bold;
	}
	#siteHeader > div.header-button > span > input.search{
		width:100px;
		background-color:transparent;
		border:0;
	}
	#siteHeader > div.header-button.right{
		float:right;
	}
	#siteHeader > div.header-button > span.header-icon > i{
		margin-top:2px;
	}
	#siteHeader > div.header-button.highlight{
		background-color:rgb(105,196,231);
	}
	#siteHeader > div.header-button.remind > div.remindSum{
		position:absolute;
		top:-4px;
		right:-3px;
		background-color:rgb(250,0,0);
		color:white;
		font-weight:bold;
		font-size:0.8em;
		width:auto!important;
		width:10px;
		min-width:10px;
		height:10px;
		line-height:10px;
		padding:3px;
		border-radius:8px;
		text-align:center;
		display:none;
	}
	#siteHeader > div.pop-up{
		position:absolute;
		border-radius:5px;
		top:45px;
		display:none;
		background-color:white;
		-moz-box-shadow:0 1px 6px #999;
 	   -webkit-box-shadow:0 1px 6px #999;
 	   box-shadow:0 1px 6px #999;
 	   z-index:999;
	}

	#siteHeader > div.pop-up.projectList,
	#siteHeader > div.pop-up.humanResource{
		left:10px;
		width:300px;
		border:1px silver solid;
	}
	#siteHeader > div.pop-up.new,
	#siteHeader > div.pop-up.profile,
	#siteHeader > div.pop-up.remind{
		right:10px;
		width:300px;
		border:1px silver solid;
	}
	#siteHeader > div.pop-up.profile > div.list{
		padding:10px 0;
	}
	#siteHeader > div.pop-up.profile > div.list > a.block,
	#siteHeader > div.pop-up.profile > div.list > div.block > a.to{
		display:block;
		padding:5px 20px;
		font-weight:bold;
		text-decoration:none;
		color:black;
	}
	#siteHeader > div.pop-up.profile > div.list > a.block:hover,
	#siteHeader > div.pop-up.profile > div.list > div.block > a.to:hover{
		color:white;
		background-color:rgb(0,128,192);
	}
	#siteHeader > div.pop-up.profile > div.list > div.block > div.inpop-up{
		display:none;
		padding:10px;
	}
	#siteHeader > div.pop-up.profile > div.list > div.block > div.inpop-up input{
		margin:0;
	}
	#siteHeader > div.pop-up > div.delete{
		position:absolute;
		top:10px;
		right:2px;
		cursor:pointer;
		color:gray;
		font-weight:bold;
		width:25px;
		height:25px;
		opacity:0.9;
			filter:alpha(opacity=90);
			-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=90)";
	}
	#siteHeader > div.pop-up > div.back{
		position:absolute;
		top:14px;
		left:15px;
		cursor:pointer;
		color:gray;
		font-weight:bold;
		width:25px;
		height:25px;
		display:none;
	}
	#siteHeader > div.pop-up.new > div.pop-up-item > div.title,
	#siteHeader > div.pop-up > div.title{
		text-align:center;
		padding:10px 0;
		margin:0px 10px;
		margin-bottom:5px;
		border-bottom:1px rgb(225,225,225) solid;
		color:gray;
	}
	#siteHeader > div.pop-up.projectList > div.content{
		padding:5px;
		overflow-x:hidden;
		overflow-y:auto;
	}
	#siteHeader > div.pop-up.projectList > div.content::-webkit-scrollbar {
		height: 9px;
		width: 9px;
	}
	#siteHeader > div.pop-up.projectList > div.content::-webkit-scrollbar-button {
		display: block;
		height: 5px;
		width: 5px;
	}
	#siteHeader > div.pop-up.projectList > div.content::-webkit-scrollbar-track-piece {
		background: rgb(235,235,235);
		border-radius:5px;
	}
	#siteHeader > div.pop-up.projectList > div.content::-webkit-scrollbar-thumb{
		background:rgb(215,215,215);
		border-radius:5px;
		display:block;
		height:10px;
	}
	#siteHeader > div.pop-up.projectList > div.content > div.block{
		margin-bottom:5px;
		background-color:rgb(0,128,192);
		border-radius:3px;
		padding-left:10%;
		cursor:pointer;
	}
	#siteHeader > div.pop-up.projectList > div.content > div.block > div.projectName{
		padding:10px;
		font-weight:bold;
		border-radius:0 3px 3px 0;
		background-color:rgb(219, 255, 237);
	}
	#siteHeader > div.pop-up.projectList > div.content > div.block:hover > div.projectName{
		background-color:rgb(178, 255, 200);
	}
	#siteHeader > div.pop-up.new > div.pop-up-item > div.body{
		padding:5px 0;
	}
	#siteHeader > div.pop-up.new > div.pop-up-item > div.body > div.block{
		padding:10px;
		cursor:pointer;
	}
	#siteHeader > div.pop-up.new > div.pop-up-item > div.body > div.block > div.title{
		font-weight:bold;
		padding:5px;
		font-size:1.2em;
	}
	#siteHeader > div.pop-up.new > div.pop-up-item > div.body > div.block > div.subTitle{
		font-size:1em;
		color:gray;
		padding:5px;
	}
	#siteHeader > div.pop-up.new > div.pop-up-item > div.body > div.block:hover{
		background-color:rgb(0,128,192);
	}
	#siteHeader > div.pop-up.new > div.pop-up-item > div.body > div.block:hover > div.title{
		color:white;
	}
	#siteHeader > div.pop-up.new > div.pop-up-item > div.body > div.block:hover > div.subTitle
	{
		color:silver;
	}
	#siteHeader > div.pop-up.new > div.pop-up-item.addProject > div.body
	{
		padding:5%;
	}
	#siteHeader > div.pop-up.new > div.pop-up-item.addProject > div.body > div.title{
		font-weight:bold;
		padding-bottom:5px;
		font-size:1em;
	}
	#siteHeader > div.pop-up.new > div.pop-up-item.addProject > div.body > div.line > input.projectName{
		width:95%;
	}
	#siteHeader > div.pop-up.remind > div.content{
		padding-bottom:10px;
		word-break:break-all;
	}
	#siteHeader > div.pop-up.remind > div.content > div.block{
		padding:10px;
		position:relative;
		font-size:0.9em;
	}
	#siteHeader > div.pop-up.remind > div.content > div.block:hover{

	}
	#siteHeader > div.pop-up.remind > div.content > div.block > div.time{
		color:silver;
		font-size:0.8em;
	}
	#siteHeader > div.pop-up.remind > div.content > div.block > div.delete{
		display:none;
		z-index:994;
		position:absolute;
		top:5px;
		right:10px;
		background-color:white;
	}
	#siteHeader > div.pop-up.remind > div.content > div.block:hover > div.delete{
		display:block;
	}
	/*手机上ipad就直接显示*/
	@media screen and (max-device-width:1100px)
	{
		#siteHeader > div.pop-up.remind > div.content > div.block > div.delete{
			display:block;
		}
	}
	#siteHeader > div.pop-up.remind > div.content > div.block > div.line{
		padding:5px 0;
		word-break:break-all;
	}
	/*手机屏幕*/
	@media screen and (max-device-width:500px)
	{
		#siteHeader > div.header-button{
			padding-top:7px;
			padding-bottom:3px;
		}
		#siteHeader > div.header-button > span.header-text
		{
			display:none
		}
		#siteHeader > div.header-button:hover{
			background-color:rgb(105,196,211);
		}
		/*弹出框*/
		#siteHeader > div.pop-up.new,
		#siteHeader > div.pop-up.profile,
		#siteHeader > div.pop-up.remind{
			right:5%;
			width:90%;
		}
		#siteHeader > div.pop-up.projectList{
			left:5%;
			width:90%;
		}
	}
	#siteHeader > div.pop-up.profile > div.list > div.block > div.inpop-up > div.line{
		padding:3px 0;
		position:relative;
	}
	#siteHeader > div.pop-up.profile > div.list > div.block > div.inpop-up > div.line > div.left{
		float:left;
		width:60px;
		padding-top:3px;
	}
	#siteHeader > div.pop-up.profile > div.list > div.block > div.inpop-up > div.line > div.right{
		margin-left:60px;
	}
	#siteHeader > div.pop-up.profile > div.list > div.block > div.inpop-up > div.line > div.alertpw{
		color:red;
		font-size:0.9em;
	}
</style>
<script type="text/javascript">
	$(document).ready(function(){
		startLoading();
		//$("#siteHeader > input.loading").change();
	});
	//loading, stop loading
	cw.ech("#siteHeader > input.loading",function(){
		//alert("a");
		$("#siteHeader > span.loading").show();
		//startLoading();
	});
	cw.ech("#siteHeader > input.stopLoading",function(){
		$("#siteHeader > span.loading").hide();
		//startLoading();
	});
	function startLoading()
	{
		setInterval(function(){
			$Object = $("#siteHeader > span.loading");
			/*
			if($Object.html() == "")
			{
				$Object.html(".");
			}
			else if($Object.html() == ".")
			{
				$Object.html("..");
			}
			else if($Object.html() == "..")
			{
				$Object.html(".:");
			}
			else if($Object.html() == ".:")
			{
				$Object.html("::");
			}
			else if($Object.html() == "::")
			{
				$Object.html("");
			}
			*/
			if($Object.html() == "")
			{
				$Object.html(".");
			}
			else if($Object.html() == ".")
			{
				$Object.html("..");
			}
			else if($Object.html() == "..")
			{
				$Object.html(".&nbsp;");
			}
			else
			{
				$Object.html("");
			}

		},300);
	}
</script>
<script type="text/javascript">
	cw.url = "/daisy/index.php/main/";
		//点击新增
	cw.ec("#siteHeader > div.header-button.new",function(){
		//alert("a");
		if($("#siteHeader > div.pop-up.new").css("display") == "none")
		{
			resetNew();
			$("#siteHeader > div.pop-up.new").show();
			$("#overlayPopups > input.show").change();
		}
		else
		{
			$("#siteHeader > div.pop-up.new").hide();
			$("#overlayPopups > input.hide").change();
		}
	});
	function resetNew()
	{
		$("#siteHeader > div.pop-up.new > div.pop-up-item").hide();
		$("#siteHeader > div.pop-up.new > div.addwhat").show();
	}
	//新增关闭
	cw.ec("#siteHeader > div.pop-up > div.delete",function(){
		$(this).parent().hide();
		$("#overlayPopups > input.hide").change();
	});
	//新增项目
	cw.ec("#siteHeader > div.pop-up.new > div.addwhat > div.body > div.block.project",function(){
		$("#siteHeader > div.pop-up.new > div.pop-up-item").hide();
		$("#siteHeader > div.pop-up.new > div.addProject").show()
			.find("div.body > div.line > input.projectName").focus();
	});
	//确认新增项目
	cw.ec("#siteHeader > div.pop-up.new > div.addProject > div.body > div.line > div.create",function(){
		var data = {};
		data.name = $(this).parent().parent().find("div.line > input.projectName").val();
		if(data.name == "")
		{
			return false;
		}
		//填充新项目名字
		$("").val(data.name);
		//显示载入中
		$("#siteHeader > input.loading").change();
		cw.post(cw.url+"newProject",data,function(result){
			//alert(result);
			//清楚新建框
			$("#siteHeader > div.pop-up.new > div.addProject > div.body > div.line > input.projectName").val("");
							$("").change();
					});
		//关闭新建框
		$("#siteHeader > div.pop-up.new").hide();
		$("#overlayPopups > input.hide").change();
	});
</script>
<script type="text/javascript">
	//点击项目框，
		cw.url = "/daisy/index.php/main/";
	cw.ec("#siteHeader > div.header-button.projectList",function(){
		if($("#siteHeader > div.pop-up.projectList").css("display") == "none")
		{
			siteHeadergetProjectList();
			$("#siteHeader > div.pop-up.projectList").show();
			$("#overlayPopups > input.show").change();
		}
		else
		{
			$("#siteHeader > div.pop-up.projectList").hide();
			$("#overlayPopups > input.hide").change();
		}
	});
	function siteHeadergetProjectList()
	{
				/*
		var data = {};
		$("#siteHeader > div.pop-up.projectList > div.content").html("<div class='wrapLoading'><div class='loading'></div></div>");
		//alert("h");
		cw.post(cw.url+"getProjectList",data,function(result){
			//alert(result.length);
			$("#siteHeader > div.pop-up.projectList > div.content").html("");
			$.each(result,function(index,item){
				$("#siteHeader > div.pop-up.projectList > div.content").prepend(siteHeadermakeProject(item.name,item.intro,item.id));
			});
			//检查项目列表是否过长
				//不检查，直接获取窗口高度，然后设置max-height
				var totalHeight = $(window).height();
				var otherHeight = 45+50+25;
				var projectListHeight = totalHeight-otherHeight;
				$("#siteHeader > div.pop-up.projectList > div.content").css("maxHeight",projectListHeight+"px");

		});
		*/
				var data = {};
		//alert("h");
		cw.post(cw.url+"getProjectList",data,function(result){
			//alert(result.length);
			//第一次载入
			if($("#siteHeader > div.pop-up.projectList > div.content > div.wrapLoading").length != 0)
			{
				$("#siteHeader > div.pop-up.projectList > div.content").html("");
			}
			$.each(result,function(index,item){
				//当此projectId不存在 ,添加到rank比其小的第一个去
				if($("#siteHeader > div.pop-up.projectList > div.content > div.block > input.projectId[value='"+item.id+"']").length == 0)
				{
					//$("#siteHeader > div.pop-up.projectList > div.content").prepend(siteHeadermakeProject(item.name,item.intro,item.id,item.rank));
						var ltIndex=0;//比其小的project的index
						$("#siteHeader > div.pop-up.projectList > div.content > div.block").each(function(){
							if($(this).children("input.rank").val() <= item.rank)
							{
								return false;
							}
							ltIndex++;
						});
						if(ltIndex == $("#siteHeader > div.pop-up.projectList > div.content > div.block").length)
						{
							$("#siteHeader > div.pop-up.projectList > div.content").append(siteHeadermakeProject(item.name,item.intro,item.id,item.rank));
						}
						else
						{
							siteHeadermakeProject(item.name,item.intro,item.id,item.rank).insertBefore($("#siteHeader > div.pop-up.projectList > div.content > div.block").eq(ltIndex));
						}
					}
				else
				{
					//更新projectname,intro
					$("#siteHeader > div.pop-up.projectList > div.content > div.block > input.projectId[value='"+item.id+"']").parent()
						.children("input.name").val(item.name).end()
						.children("input.intro").val(item.intro).end()
						.children("input.rank").val(item.rank).end()
						.children("div.projectName").html(item.name).end();
						//.children("div.projectIntro").html(item.intro);
				}
			});
			var totalHeight = $(window).height();
				var otherHeight = 45+50+25;
				var projectListHeight = totalHeight-otherHeight;
				$("#siteHeader > div.pop-up.projectList > div.content").css("maxHeight",projectListHeight+"px");
		});
	}
	function siteHeadermakeProject(name,intro,projectId,rank)
	{
		return $('<div class="block">'+
			'<input class="projectId" type="hidden" value="'+projectId+'"></input>'+
			'<input class="name" type="hidden" value="'+name+'"></input>'+
			'<input class="rank" type="hidden" value="'+rank+'"></input>'+
			'<input class="intro" type="hidden" value="'+intro+'"></input>'+
			'<div class="projectName">'+name+'</div>'+
			//'<div class="projectIntro">'+intro+'</div>'+
		'</div>');
	}
	//点击project
	cw.ec("#siteHeader > div.pop-up.projectList > div.content > div.block",function(){
		var projectId = $(this).children("input.projectId").val();
		var projectName = $(this).children("input.name").val();
		var projectIntro = $(this).children("input.intro").val();
					$("#cIndex > #project > input.projectName").val(projectName);
							$("#cIndex > #project > input.projectIntro").val(projectIntro);
				$("#cIndex > #project > input.projectId").val(projectId);
						$("#cIndex > #project > input.projectId").change();
						$("#cIndex > input.toProject").change();
				//关闭此框
		$("#siteHeader > div.pop-up.projectList").hide();
		$("#overlayPopups > input.hide").change();
	});
</script>
<script type="text/javascript">
	//点击首logo的事件
	cw.ec("#siteHeader > a.logo",function(e){
		e.preventDefault();
		//window.location.reload();
		window.open("/daisy/","_self");
		/*
						$("#cIndex > input.gotoDatasetList").change();
				//隐藏返回
		$("#siteHeader > div.back").hide();
		*/
	});
</script>
<script type="text/javascript">
	//点击profile
	cw.ec("#siteHeader > div.header-button.profile",function(){
		//alert("a");
		if($("#siteHeader > div.pop-up.profile").css("display") == "none")
		{
			//把profile内所有inpop-up 隐藏,显示按钮
			$("#siteHeader > div.pop-up.profile > div.list > div.block > div.inpop-up").hide();
			$("#siteHeader > div.pop-up.profile > div.list a").show();
			$("#siteHeader > div.pop-up.profile > div.back").hide();
			$("#siteHeader > div.pop-up.profile").show();
			$("#overlayPopups > input.show").change();
		}
		else
		{
			$("#siteHeader > div.pop-up.profile").hide();
			$("#overlayPopups > input.hide").change();
		}
	});
	//点击to,打开inpop-up
	cw.ec("#siteHeader > div.pop-up.profile > div.list > div.block > a.to",function(){
		$(this).parent().children("div.inpop-up").show()
			.find("input").eq(0).focus();
		$(this).parent().parent().find('a').hide();
		//显示返回按钮
		$("#siteHeader > div.pop-up.profile > div.back").show();
	});
	//inpop-up 返回
	cw.ec("#siteHeader > div.pop-up.profile > div.back",function(){
		//把profile内所有inpop-up 隐藏,显示按钮
		$("#siteHeader > div.pop-up.profile > div.list > div.block > div.inpop-up").hide();
		$("#siteHeader > div.pop-up.profile > div.list a").show();
		$(this).hide();
	});
	//确认修改名字
	cw.ec("#siteHeader > div.pop-up.profile > div.list > div.block > div.changeName > div.ok",function(){
		var data = {};
		data.nickname = $(this).parent().children("input.nickname").val();
		if(data.nickname == "")
		{
			return false;
		}
		cw.post(cw.url+"changeNickname",data,function(result){

		});
		$("#siteHeader > div.pop-up.profile").children("input.nickName").val(data.nickname).end()
			.children("div.title").html(data.nickname);
		$("#siteHeader > div.header-button.profile > span.header-text").html(data.nickname);
		//触发返回
		$("#siteHeader > div.pop-up.profile > div.back").trigger(cw.ectype);
	});
	//确认修改密码
	cw.ec("#siteHeader > div.pop-up.profile > div.list > div.block > div.changePw > div.ok",function(){

		var data = {};
		data.oldPw = $(this).parent().find("div.line > div.right > input.oldPw").val();
		data.newPw = $(this).parent().find("div.line > div.right > input.newPw").val();
		data.newPw1 = $(this).parent().find("div.line > div.right > input.newPw2").val();
		if($(this).hasClass("disabled") || (data.oldPw == "") || (data.newPw == ""))
		{
			return false;
		}
		if(data.newPw != data.newPw1)
		{
			setPwAlert("Passwords are not the same.");
			return;
		}
		//不检查格式了

		$(this).addClass("disabled").html("Sending request...");
		setPwAlert('<div class="wrapLoading"><div class="loading"></div></div>',true);
		cw.post(cw.url+"changePw",data,function(result){
			$(this).removeClass("disabled").html("OK");
			//
			if(result.error == 1)
			{
				setPwAlert("Original password is not correct.");
			}
			else
			{
				setPwAlert("Success");
				$(this).parent().find("input").val("");
			}
		},$(this));
	});
	function setPwAlert(str)
	{
		var noErase = arguments[1]?arguments[1]:false;
		$("#siteHeader > div.pop-up.profile > div.list > div.block > div.changePw > div.line > div.alertpw").html(str);
		if(!noErase)
		{
			setTimeout(function(){
				$("#siteHeader > div.pop-up.profile > div.list > div.block > div.changePw > div.line > div.alertpw").html("");
			},3000);
		}
	}
</script>
<script type="text/javascript">
	//点击人力资源
	cw.ec("#siteHeader > div.header-button.humanResource",function(){
		if($("#siteHeader > div.pop-up.humanResource").css("display") == "none")
		{
			//载入人力资源
			$("#siteHeader > div.pop-up.humanResource > input.loadHR").change();
			$("#siteHeader > div.pop-up.humanResource").show();
			$("#overlayPopups > input.show").change();
		}
		else
		{
			$("#siteHeader > div.pop-up.humanResource").hide();
			$("#overlayPopups > input.hide").change();
		}
	});
</script>
<script type="text/javascript">
	//显示返回按钮
	cw.ech("#siteHeader > input.showBack",function(){
		//alert("ss");
		$("#siteHeader > div.back").show();
	});
	//点击返回
	cw.ec("#siteHeader > div.back",function(){
		$("#siteHeader > a.logo").trigger(cw.ectype);
	});
	cw.ech("#siteHeader > input.closePopup",function(){
		//alert('d');
		$("#siteHeader > div.pop-up").hide();
	});
	//点击logo
	cw.ec("#siteHeader > a.logo",function(){
		window.location.hash = "";
	});
</script>
<script type="text/javascript">
	//进入页面获取提醒数量
	$(document).ready(function(){
		//getRemindSum();
	});
	//轮训获取提醒数量
	/*
	setInterval(function(){
		getRemindSum();
	},20000);//20秒
*/
	function getRemindSum()
	{
		var data = {};
		data.userId = "a";
		//setRemindSum(1);
		cw.post(cw.url+"getRemindSum",data,function(result){
			setRemindSum(result.remindSum);

		});
	}
	function setRemindSum(number)
	{
		if(number > 0)
		{
			highlight($("#siteHeader > div.header-button.remind"));
			$("#siteHeader > div.header-button.remind > div.remindSum").show().html(number);
		}
		else
		{
			dehighlight($("#siteHeader > div.header-button.remind"));
			$("#siteHeader > div.header-button.remind > div.remindSum").hide();
		}
	}
	function highlight(object)
	{
		object.addClass("highlight");
	}
	function dehighlight(object)
	{
		object.removeClass("highlight");
	}

	//点击消息
	cw.ec("#siteHeader > div.header-button.remind",function(){
		//显示
		if($("#siteHeader > div.pop-up.remind").css("display") == "none")
		{
			setRemindSum(0);
			getRemind();
			$("#siteHeader > div.pop-up.remind").show();
			$("#overlayPopups > input.show").change();
		}
		else
		{
			//关闭弹出
			$("#siteHeader > div.pop-up.remind").hide();
			$("#overlayPopups > input.hide").change();
		}
	});
	function getRemind()
	{
		//获取消息详情
		var data = {};
		cw.post(cw.url+"getReminds",data,function(result){
			//原来是载入中或者没有更多，就清除
			if($("#siteHeader > div.pop-up.remind > div.content > div.wrapLoading").length > 0)
			{
				$("#siteHeader > div.pop-up.remind > div.content").html("");
			}
			//没有提醒且原来是空白的
			if((result.reminds.length == 0) && ($("#siteHeader > div.pop-up.remind > div.content > div.block").length == 0))
			{
				setRemindNoMore();
			}
			$.each(result.reminds,function(index,item){
				//先检查有没重复
				if($("#siteHeader > div.pop-up.remind > div.content > div.block > input.remindId[value='"+item.remindId+"']").length == 0)
				{
					var newBlock = cw.parseRemind(item);
					$("#siteHeader > div.pop-up.remind > div.content").prepend(newBlock);
				}
			});
		});
	}
	//删除此提醒
	cw.ec("#siteHeader > div.pop-up.remind > div.content > div.block > div.delete",function(){
		$(this).parent().remove();
		//空了就加“没有更多了”
		if($("#siteHeader > div.pop-up.remind > div.content > div.block").length == 0)
		{
			setRemindNoMore();
		}
	});
	function setRemindNoMore()
	{
		$("#siteHeader > div.pop-up.remind > div.content").html("<div class='wrapLoading'>"+
					"<span style='color:gray'>没有更多了</span>"+
				"</div>");
	}
	// click help
	cw.ec("#siteHeader > div.header-button.help",function(){
		window.open("/daisy/index.php/application/cHelp","_self");
	});
</script>
<div class="makeupspace"></div>
<div id="siteHeader">
	<style type="text/css">
	#overlayPopups{
		height:100%;
		width:100%;
		display:none;
		position:fixed;
		top:0;
		left:0;
		z-index:998;
					background:transparent;
			}
</style>
<script type="text/javascript">
	cw.ech("#overlayPopups > input.show",function(){
		$("#overlayPopups").show();
	});
	cw.ech("#overlayPopups > input.hide",function(){
		$("#overlayPopups").hide();
	});
	//点击mask后响应,然后消失
	cw.ec("#overlayPopups",function(){
		//alert("a");
					$("#siteHeader > input.closePopup").change();
				$("#overlayPopups").hide();
	});
</script>
<div id="overlayPopups">
	<input class="show" type="hidden">
	<input class="hide" type="hidden">
</div>	<input class="closePopup" type="hidden">
	<input class="showBack" type="hidden">
	<input class="loading" type="hidden">
	<input class="stopLoading" type="hidden">
	<a class="logo" title="home" href="https://aladdin1.inf.cs.cmu.edu/daisy/">
		事件重构3D演示系统	</a>
	<span class="loading" style="display:none"></span>
		<!--
	<div class="header-button projectList">
		<span class="header-icon"><i class="icon-th-large icon-white"></i></span>
		<span class="header-text">项目列表</span>
	</div>
	-->
	<div class="back">
		<i class="icon-chevron-left"></i>
	</div>
	<!--
	<div class="header-button humanResource">
		<span class="header-icon"><i class="icon-globe icon-white"></i></span>
		<span class="header-text">Human Resource</span>
	</div>
	-->
	<!--
	<div class="header-button">
		<span class="header-icon"><i class="icon-search icon-white"></i></span>
		<span class="header-text">
			<input class='search' ></input>
		</span>
	</div>
	-->
	<div class="header-button right profile">
		<span class="header-icon"><i class="icon-th-large icon-white"></i></span>
		<span class="header-text">用户</span>
	</div>
	<div class="header-button right help">
		<span class="header-icon"><i class="icon-exclamation-sign icon-white"></i></span>
		<span class="header-text">帮助</span>
	</div>
	<!--
	<div class="header-button right remind">
		<div class="remindSum"></div>
		<span class="header-icon"><i class="icon-bell icon-white"></i></span>
		<span class="header-text">Message</span>
	</div>
	-->

		<div class="pop-up remind">
		<div class="delete close">×</div>
		<div class="title">Message</div>
		<div class="content"><div class="wrapLoading"><div class="loading"></div></div></div>
	</div>
		<!--
	<div class="pop-up projectList">
		<div class="delete close">&times;</div>
		<div class="title">项目列表</div>
		<div class="content"><div class='wrapLoading'><div class='loading'></div></div></div>
	</div>
	-->

	<div class="pop-up humanResource">
		<div class="delete close">×</div>
		<div class="title">Human Resource</div>
		<input class="loadHR" type="hidden">
		<div class="content">
					</div>
	</div>
	<div class="pop-up profile">
		<div class="close back"><i class="icon-chevron-left"></i></div>
		<div class="delete close">×</div>
		<div class="title">demo</div>
		<input class="nickName" type="hidden" value="demo">
		<div class="list">
			<div class="block">
				<a class="to" href="https://aladdin1.inf.cs.cmu.edu/daisy/index.php/application/cPointCloudVideo#">Change Nickname</a>
				<div class="changeName inpop-up">
					<input class="input-medium nickname" type="text" value="demo">
					<div class="btn ok">OK</div>
				</div>
			</div>
			<div class="block">
				<a class="to" href="https://aladdin1.inf.cs.cmu.edu/daisy/index.php/application/cPointCloudVideo#">Change Password</a>
				<div class="changePw inpop-up">
					<div class="line">
						<div class="left">Original: </div>
						<div class="right">
							<input class="input-medium oldPw" type="password" value="">
						</div>
					</div>
					<div class="line">
						<div class="left">New: </div>
						<div class="right">
							<input class="input-medium newPw" type="password" value="">
						</div>
					</div>
					<div class="line">
						<div class="left">Again: </div>
						<div class="right">
							<input class="input-medium newPw2" type="password" value="">
						</div>
					</div>
					<div class="line">
						<div class="alertpw"></div>
					</div>
					<div class="btn btn-block ok">OK</div>
				</div>
			</div>
			<a class="block" href="https://aladdin1.inf.cs.cmu.edu/daisy/index.php/application/cWatch">Watch Video Pairs</a>
			<a class="block" href="https://aladdin1.inf.cs.cmu.edu/daisy/index.php/application/cApp">App List</a>
			<!--<a class="block" href="/daisy/index.php/application/cGunshot">gunshot detection</a>-->
			<a class="block" href="https://aladdin1.inf.cs.cmu.edu/daisy/index.php/user/logout">Logout</a>
		</div>
	</div>

</div><style type="text/css">
#siteHeader{
		position:fixed;
		top:0;
		left:0;
		z-index:9999;
	}
	#cHtml3d{
		background-color:white;
		width:1400px;
		margin:0px auto;
		min-height:800px;
	}
	#cHtml3d input{margin:0px}
	#cHtml3d > div.main > div.mainControls{
		padding:10px 0;
	}
	#cHtml3d > div.main > div.mainControls > div.videoControl{
		border-top:1px silver solid;
		margin-bottom:20px;
	}
	#cHtml3d > div.main > div.mainControls > div.videoControl > div.block{
		text-align:center;
		border-left:5px green solid;
		border-bottom:4px silver solid;
		border-top:1px silver solid;
		border-right:1px silver solid;
		padding-top:5px;
		margin-bottom:10px;
	}
	#cHtml3d > div.main > div.mainControls > div.videoControl > div.block > video{
		width:100%;
	}
	#cHtml3d > div.main > div.mainControls > div.videoControl > div.block > div.controls{
		display:none;
	}
	div.main > div.mainControls > div.videoControl > div.block > div.controls > i{cursor:pointer}



</style>
<script language="javascript" src="js/three.min.js"></script>
<script language="javascript" src="js/stats.min.js"></script>
<script language="javascript" src="js/dat.gui.min.js"></script>
<script language="javascript" src="js/OrbitControls.js"></script>
<script language="javascript" src="js/PLYLoader.js"></script>
<script language="javascript" src="js/ImageUtils.js"></script>
<script language="javascript" src="js/popcorn-complete.js"></script>
<script language="javascript" src="js/tween.min.js"></script>
<!-- just for draggable -->
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
<script>

function getVideoTexture(url)
{
	var temp = {};
	// create the video element
	temp.video	= document.createElement('video');
	temp.video.width	= 320;
	temp.video.height	= 200;
	temp.video.autoplay	= false;
	temp.video.loop	= false;
	temp.video.src	= url;

	// create the texture
	var texture	= new THREE.Texture( temp.video );
	// expose texture as this.texture
	temp.texture = texture;
	temp.texture.minFilter = THREE.LinearFilter;

	temp.update	= function(){
		if( temp.video.readyState !== temp.video.HAVE_ENOUGH_DATA )	return;
		texture.needsUpdate	= true;
	}

	temp.destroy = function(){
		temp.video.pause()
	}
	return temp;
}
function getVideoname(url)
{
   var base = new String(url).substring(url.lastIndexOf('/') + 1);
	if(base.lastIndexOf(".") != -1)
		base = base.substring(0, base.lastIndexOf("."));
   return base;
}
// return a group of human shape, its 0,0,0 is the feet
function makePerson(color,personId,pathToImg)
{
	var radius=0.2,cheight=1.0; // this cheight+2*radius should be the person average height (after scaleFactor)
	var cylinderGeo = new THREE.CylinderGeometry( radius, radius, cheight, 10 );
	var cylinderMat = new THREE.MeshBasicMaterial({wireframe:true,color: color});
	var cylinder = new THREE.Mesh( cylinderGeo, cylinderMat);
	cylinder.position.set(0,cheight/2,0);


	//put a sphere on top of the cylinder
	var sphereGeo = new THREE.SphereGeometry( radius, 10, 10 );
	var sphereMat = new THREE.MeshBasicMaterial( {wireframe:true,color: color} );
	var sphere = new THREE.Mesh( sphereGeo, sphereMat );
	sphere.position.set(0,cheight+radius,0);

	// add a plane on infront and put the person pic on it
	//console.log(pathToImg);
	var imgTexture = new THREE.TextureLoader().load(pathToImg);
	imgTexture.minFilter = THREE.LinearFilter;
	imgTexture.repeat.set(1,1);
	var imgMaterial = new THREE.MeshBasicMaterial({
		map : imgTexture
	});
	var noneMaterial = new THREE.MeshBasicMaterial({color:color});
	var materials = [
		noneMaterial,
		noneMaterial,
		noneMaterial,
		noneMaterial,
		imgMaterial, // this is the back of that face
		noneMaterial // this is the face for cube when using lookAt(point)
	 ];

	var cubeGeometry = new THREE.BoxGeometry(2*radius, cheight+2*radius, radius/4);
	var cube = new THREE.Mesh( cubeGeometry, new THREE.MultiMaterial(materials));
	cube.position.set(0,(cheight+2*radius)/2,radius);//

	var group = new THREE.Object3D();
	group.up = new THREE.Vector3(0,0,1);// important to keep the video correct
	group.add(cylinder);
	group.add(sphere);
	group.add(cube);
	group.name = personId;
	return group;
}
// return a cube with the video and a cone
// var [group,video] = makeVideoGroup(url);
function makeVideoGroup(videoUrl,color)
{
	var videoname = getVideoname(videoUrl);
	// make 2D text material for the cube, for videoname
	var canvasText = document.createElement("canvas");
	var context1 = canvasText.getContext("2d");
	context1.fillStyle="black";
	context1.fillRect(0,0,canvasText.width,canvasText.height);
	context1.font = "Bold 20px Arial";
	context1.fillStyle = "rgba(255,0,0,1.0)";
	context1.fillText(videoname,0,80);// y has to be 50 as the font size?
	var textTexture = new THREE.Texture(canvasText);
	textTexture.needsUpdate = true;
	textTexture.minFilter = THREE.LinearFilter;
	var textMaterial = new THREE.MeshBasicMaterial({map:textTexture,side:THREE.DoubleSide});
	textMaterial.transparent = false;

	// the video material
	var videoTexture = getVideoTexture(videoUrl);
	var cubeMaterial = new THREE.MeshBasicMaterial({
		map : videoTexture.texture
	});

	// the other side of the cube
	var noneMaterial = new THREE.MeshBasicMaterial({color:color});
	var materials = [
		noneMaterial,
		noneMaterial,
		noneMaterial,
		noneMaterial,
		textMaterial, // this is the back of that face
		cubeMaterial // this is the face for cube when using lookAt(point)
	 ];

	// width, height, depth
	var cubeGeometry = new THREE.BoxGeometry(2, 1.25, 0.4,1,1,1);
	var cube = new THREE.Mesh( cubeGeometry, new THREE.MultiMaterial(materials));

	cube.position.set(0,0,0);
	// for degree (0-360)
	//cube.rotation.set(degree*(Math.PI/180), 0, 0);
	//rotate the Z so when the group lookAt, the TV is correct angle



	// radius, height, faces
	var cgeometry = new THREE.ConeGeometry( 12, 20, 20 );// radius can be changed independtly
	var cmaterial = new THREE.MeshBasicMaterial( {color: "silver"} );
	cmaterial.transparent = true;
	cmaterial.opacity = 0.05;
	var cone = new THREE.Mesh( cgeometry, cmaterial );
	cone.position.set(0,0,10);// the last position has to be half of the height
	cone.rotateX(270 * (Math.PI/180));

	var group = new THREE.Object3D();
	group.up = new THREE.Vector3(0,0,1);// important to keep the video correct

		// add cube number 2 as a projection
		var noneMaterial2 = new THREE.MeshBasicMaterial({color:color,"transparent":true,"opacity":0.0});
		var cubeMaterial2 = new THREE.MeshBasicMaterial({
			map : videoTexture.texture,
			"transparent":true,
			"opacity":0.4,
		});
		var m = [
			noneMaterial2,
			noneMaterial2,
			noneMaterial2,
			noneMaterial2,
			noneMaterial2, // this is the back of that face
			cubeMaterial2 // this is the face for cube when using lookAt(point)
		 ];
		var cube2 = new THREE.Mesh( new THREE.BoxGeometry(24, 15, 0.2,1,1,1), new THREE.MultiMaterial(m));
		cube2.position.set(0,0,20);// the height of the cone
		cube2.name = "projectCube";
		group.add(cube2);


	group.add(cube);
	group.add(cone);
	group.name = videoname;
	return [group,videoTexture]; // return the videoTexture so that we can update it, and control the video outside
}


function createBackgroundTexture(width, height){

	function gauss(x, y){
		return (1 / (2 * Math.PI)) * Math.exp( - (x*x + y*y) / 2);
	};

	var map = THREE.ImageUtils.generateDataTexture( width, height, new THREE.Color() );
	map.magFilter = THREE.NearestFilter;
	var data = map.image.data;

	//var data = new Uint8Array(width*height*4);
	var chroma = [1, 1.5, 1.7];
	var max = gauss(0, 0);

	for(var x = 0; x < width; x++){
		for(var y = 0; y < height; y++){
			var u = 2 * (x / width) - 1;
			var v = 2 * (y / height) - 1;

			var i = x + width*y;
			var d = gauss(2*u, 2*v) / max;
			var r = (Math.random() + Math.random() + Math.random()) / 3;
			r = (d * 0.5 + 0.5) * r * 0.03;
			r = r * 0.4;

			//d = Math.pow(d, 0.6);

			data[3*i+0] = 255 * (d / 15 + 0.05 + r) * chroma[0];
			data[3*i+1] = 255 * (d / 15 + 0.05 + r) * chroma[1];
			data[3*i+2] = 255 * (d / 15 + 0.05 + r) * chroma[2];

			//data[4*i+3] = 255;

		}
	}

	return map;
};
var timeTol = 0.0001;// this is the time Tolenrence for comparing the current time with video time
// also the cameraParam smaller than this timeTol will be ignored
function parseCameraParam(cameraParamStr)// the whole file as a str
{
	var data = new Array();
	var lines = cameraParamStr.split("\n");
	var lastTime = null;// remember current time for ignoring the camera param too close to the last one
	var lastThing = null;// last valid points
	var skipped = 0;
	for(var i=0;i<lines.length;++i)
	{
		if($.trim(lines[i]) == "")
		{
			continue;
		}
		var things = lines[i].split(" ");
		if(things.length != 8)
		{
			console.log("warning, param file format not right, line:"+i);
			continue;
		}
		var videoTime = parseFloat(things[7]) //解析一个字符串并返回一个浮点数
		if(lastTime==null)
		{
			lastTime = videoTime;
		}
		else
		{
			// check the current videotime with the last time
			var curTime = videoTime;
			if(Math.abs(curTime - lastTime) < timeTol)
			{
				continue;
			}
			else
			{
				lastTime = curTime;
			}
		}
		var cam_x=parseFloat(things[0]);
		var cam_y=parseFloat(things[1]);
		var cam_z=parseFloat(things[2]);
		var cam_look_x=parseFloat(things[3])+parseFloat(things[0]);
		var cam_look_y=parseFloat(things[4])+parseFloat(things[1]);
		var cam_look_z=parseFloat(things[5])+parseFloat(things[2]);
				// for smoothing
		if(lastThing == null)
		{
			lastThing = [
				cam_x,// cam_x
				cam_y,//y
				cam_z,
				cam_look_x,
				cam_look_y,
				cam_look_z,
				videoTime
			];
		}
		else
		{
			var timeDiff = videoTime - lastThing[6];
			var cam_pos_dist = calDist(lastThing[0],lastThing[1],lastThing[2],cam_x,cam_y,cam_z)/timeDiff;
			var cam_look_dist = calDist(lastThing[3],lastThing[4],lastThing[5],cam_look_x,cam_look_y,cam_look_z)/timeDiff;
			//console.log([cam_pos_dist,cam_look_dist,videoTime]);
			lastThing = [
				cam_x,// cam_x
				cam_y,//y
				cam_z,
				cam_look_x,
				cam_look_y,
				cam_look_z,
				videoTime
			];
			// before scaleFactor
			if((cam_pos_dist > 0.2) || (cam_look_dist > 0.2))
			{
				skipped+=1;
				continue;
			}
		}
		data.push([
			cam_x,// cam_x
			cam_y,//y
			cam_z,
			cam_look_x,
			cam_look_y,
			cam_look_z,
			videoTime,// videoTime in seconds
		]);
	}
	/*
	// assuming the original file is sorted based on time
	data.sort(function(a,b){
		if (a[6] < b[6]) return -1;
		   if (a[6] > b[6]) return 1;
		   return 0;
	});*/
	//console.log(data.length);
		console.log("camSmoothing, orignal data points:"+(data.length+skipped)+",skipped:"+skipped);
		return data;
}
function calDist(x1,y1,z1,x2,y2,z2)
{
	return (x1-x2)*(x1-x2)+(y1-y2)*(y1-y2)+(z1-z2)*(z1-z2);
}
function getCameraPos(paramList,currentTime)
{
	// assuming the paramList is sorted,
	// paramlist is array of 7 (cam_xyz,cam_look_xyz,videoTime)
	// first check smallest and largest
	if(currentTime <= paramList[0][6])
	{
		return [paramList[0][6],[
				paramList[0][0],
				paramList[0][1],
				paramList[0][2],
				paramList[0][3],
				paramList[0][4],
				paramList[0][5]
		]];
	}
	var last = paramList.length-1;
	if(currentTime > paramList[last][6])
	{
		return [paramList[last][6],[
				paramList[last][0],
				paramList[last][1],
				paramList[last][2],
				paramList[last][3],
				paramList[last][4],
				paramList[last][5]
		]];
	}

	for(var i=0;i<paramList.length-1;++i)// not the last one
	{
		// when it is close to that one
		if((currentTime > paramList[i][6]) && (currentTime <= paramList[i+1][6]))
		{
			return [paramList[i+1][6],[
				paramList[i+1][0],
				paramList[i+1][1],
				paramList[i+1][2],
				paramList[i+1][3],
				paramList[i+1][4],
				paramList[i+1][5]
			]];
		}
	}
	return [null,null];
}
// assuming the tracking is sorted timestamp ASC
function parseTracking(cameraParamStr)// the whole file as a str
{
	// return the point list and videotime for each person
	//timestamp	person_id	x	y	z
	var data = {};
	var lines = cameraParamStr.split("\n");
	var loaded =0;
	for(var i=0;i<lines.length;++i)
	{
		if($.trim(lines[i]) == "")
		{
			continue;
		}
		var things = lines[i].split(" ");
		if(things.length != 5)
		{
			console.log("warning, param file format not right, line:"+i);
			continue;
		}

		var personId=things[1],timestamp=parseFloat(things[0]),x=parseFloat(things[2]),y=parseFloat(things[3]),z=parseFloat(things[4]);


		if(data[personId] == null)
			data[personId] = {"posList":new Array(),"lastTarget":null};

		// check whether the time interval is too small, then discard it
		if(data[personId]['posList'][data[personId].length-1] != null)
		{
			if(Math.abs(timestamp - data[personId]['posList'][data[personId].length-1][3]) < timeTol)
			{
				continue;
			}
		}

		data[personId]['posList'].push([
			x,y,z,timestamp
		]);
		loaded++;
	}
	/*
	// assuming the original file is sorted based on time
	data.sort(function(a,b){
		if (a[6] < b[6]) return -1;
		   if (a[6] > b[6]) return 1;
		   return 0;
	});*/
	console.log(data);
	console.log(loaded);
	return data;
}
function getTrackingPos(paramList,currentTime)
{
	// assuming the paramList is sorted,
	// paramlist is array of 4 (xyz,videoTime)
	// first check smallest and largest
	// this will return null as the position, since we won't show the position
	// return (videoTime, newPos, lastPos)
	if(currentTime <= paramList[0][3])
	{
		return [paramList[0][3],null,null];
	}
	var last = paramList.length-1;
	if(currentTime > paramList[last][3])
	{
		return [paramList[last][3],null,null];
	}

	for(var i=0;i<paramList.length-1;++i)// not the last one
	{
		// when it is close to that one
		if((currentTime > paramList[i][3]) && (currentTime <= paramList[i+1][3]))
		{
			return [paramList[i+1][3],[
				paramList[i+1][0],
				paramList[i+1][1],
				paramList[i+1][2],
			],[
				paramList[i][0],
				paramList[i][1],
				paramList[i][2],
			]];
		}
	}
	return [null,null,null];
}
// plugin for globaltime to add video at a time
(function (Popcorn) {

  Popcorn.plugin( "setupVideo", {

	  start: function( event, options ) {
	  	// now the video should be played,
	  	// video object is in the options
		  var timediff = options.globalTimeline.currentTime() - options.video.offset;
		  options.video.pp.currentTime(timediff);
		  //options.vid.showVid();
		  if (!options.globalTimeline.media.paused) {
			options.video.pp.play();
		  }
	  },

	  end: function( event, options ) {
		var timediff = options.globalTimeline.currentTime() - options.video.offset;
		// console.log(timediff);

		if (timediff < 0) {
		  options.video.pp.pause(0);
		} else if (options.globalTimeline.currentTime() > options.video.offset) {
		  options.video.pp.pause(options.video.pp.duration());
		}
	  }
  });

})( Popcorn );
// set up the 3d thing
var personColors = ["red","azure","yellow","navy","white","orange","gray","silver","purple", "turquoise", "chocolate",  "coral","ivory", "gold","green","blue"];
function init()
{
	// camera as global for mouse click
	var camera = null;
	var raycaster = null; // global, so that in draw() loop it can be updated
	var mouse = null;
	var scene = null;
	var scaleFactor = 10;// all cordinates scale to this for easier navigation
	var videos = {};// video dictionary for global event [videoname => {}]

	var colors = ["red","azure","yellow","navy","white","orange","gray","silver","purple", "turquoise", "chocolate",  "coral","ivory", "gold","green","blue"];

	var trackingVideoPerson2img = {};
	var winHeight = $("#webgl").height();
	var winWidth = $("#webgl").width();
	raycaster = new THREE.Raycaster();// for selecting thing
	scene = new THREE.Scene();
	// (field of view,aspect ratio,near, far) // closer to near or further to far won't be randered
	// fov is 0 -360, 60 is normal
	// 创建一个摄像机对象
	camera = new THREE.PerspectiveCamera(80,winWidth/winHeight,0.01,1000);

	// ------------------------------------------for the background ----------------------------------
	var texture = createBackgroundTexture(512, 512);

	texture.minFilter = texture.magFilter = THREE.LinearFilter;

	var bg = new THREE.Mesh(
		new THREE.PlaneBufferGeometry(2, 2, 0),
		new THREE.MeshBasicMaterial({
			map: texture
		})
	);
	//bg.position.z = -1;
	bg.material.depthTest = false;
	bg.material.depthWrite = false;
	var sceneBG = new THREE.Scene();
	sceneBG.add(bg);
	var backgroundCamera = new THREE.Camera();
	//-----------------------------------------------------------------------------------------
    //创建一个W
	var renderer = new THREE.WebGLRenderer();
	//renderer.setClearColor(new THREE.Color("silver"));
	renderer.setSize(winWidth,winHeight);
	renderer.autoClear = false; // we need to render both background and foreground scene

	// add a axis thing
	//var axes = new THREE.AxisHelper( 2 );
	//scene.add(axes);

	// load the point cloud!
	var plyLoaded = false;
	var loader = new THREE.PLYLoader();
	loader.load("./try.ply",
		// onLoad
		function(geometry){
			// geometry has position, color
			//console.log(geometry.attributes.color);//{uuid: "0539B2BF-1596-43F2-A644-B32602AD51EC", array: Float32Array[108513], itemSize: 3, count: 36171, normalized: false…}
			//console.log(geometry.attributes.color.count); //36171
			//console.log(geometry.attributes.color.array.length); //108513

			var material = new THREE.PointsMaterial({ color: 0x808080, size: 0.15 });
			var mesh = new THREE.Points(geometry, material);//its position is 0,0,0
			mesh.scale.set(scaleFactor,scaleFactor,scaleFactor);
			scene.add(mesh);
			if(plyLoaded == false)//that means the progress cannot get it
			{
				$("#loadProgress").hide();
				// when the ply loaded, check video loaded or not
				plyLoaded = true;
				if(plyLoaded && (readies == videoCount))
				{
					setupTimeline();
				}

			}
		},
		//onprogress
		function ( event ) { //XMLHttpRequestProgressEvent {isTrusted: true, position: 3774, totalSize: 2296551, lengthComputable: true, loaded: 3774…}bubbles: falsecancelBubble: falsecancelable: falsecurrentTarget: XMLHttpRequestdefaultPrevented: falseeventPhase: 0isTrusted: trueisTrusted: truelengthComputable: trueloaded: 3774path: Array[0]position: 3774returnValue: truesrcElement: XMLHttpRequesttarget: XMLHttpRequesttimeStamp: 827.5500000000001total: 2296551totalSize: 2296551type: "progress"__proto__: ProgressEvent undefined undefined
		  // console.log( event );
			//put the loading progress to a progress bar
			if(event.lengthComputable == false)
			{
				var progress = 100;
			}
			else
			{
				var loaded = event.loaded/event.total;
				var progress = parseFloat(loaded)*100;
			}
			//console.log(progress);
			progress = progress.toFixed(3) + "%";
			$("#loadProgress").children("div.bar").width(progress).html(progress);
			if(event.loaded = event.total)
			{
				$("#loadProgress").hide();
				// when the ply loaded, check video loaded or not
				plyLoaded = true;
				if(plyLoaded && (readies == videoCount))
				{
					setupTimeline();
				}

			}
		},
		function(){}//onError
	);

	var readies = 0;
	var videoCount = 3;
	function readyVideo()
	{
		// when a video is "canplaythrough", this will be called
		//console.log($(this)); // this is a popcorn object
		readies+=1;
		if((readies == videoCount) && plyLoaded)
		{

			// now we have the duration and offset, we can setup the control timeline
			setupTimeline();
		}
	};

	var globalTimeline = null;
	var fulldur = 0.0;// the full duration of all videos (and some more)
	function setupTimeline()
	{
		//console.log("video loaded, start setting up timeline");
		// get the full duration of the global timeline
		for(var videoname in videos)
		{
			var video = videos[videoname].video;
			var offset = videos[videoname].offset;
			var extend = video.duration + offset+1.0;
			if(extend > fulldur)
			{
				fulldur = extend;
			}
			//remove some event listeners
			//console.log(videos[videoname].pp.duration());
			videos[videoname].pp.off("canplaythrough");
			// only show the fist video
			if(offset != 0.0)
			{
				var videogroup = scene.getObjectByName(videoname);
				if(videogroup!=null)
				{
					videogroup.visible = false;
				}
			}
		}
		//console.log(fulldur);
		// make a null video wrapper as the global timeline
		var glpp = Popcorn.HTMLNullVideoElement("#videoTimeline");
		glpp.src = "#t=,"+fulldur;
		globalTimeline = Popcorn(glpp);
		globalTimeline.currentTime(0);

		// make the block in the timeline, add video to timeline trigger event
		for(var videoname in videos)
		{
			var video = videos[videoname];
			var temp = $("<div class='block'>"+
				"<div class='video' title="+videoname+"></div>"+
			"</div>");
			temp.children("div.video").css({
				"width":video.pp.duration()/fulldur * 100+"%",
				"left":video.offset/fulldur * 100+ "%",
				"backgroundColor":video.color,
			});
			//console.log(video.video.duration);
			$("#videoTimeline > div.videos").append(temp);
			//set up timeupdate listener for each  video for fixing deplay
			video.pp.on("timeupdate",function(){
				var delay = (globalTimeline.currentTime() - (this.offset + this.currentTime()));
				if (!globalTimeline.media.paused && (Math.abs(delay) > 1.5)) { // bigger than seconds
					this.currentTime(globalTimeline.currentTime() - this.offset);
				}

			});
			// set up an popcorn event for each video
			globalTimeline.setupVideo({
				"start":video.offset,
				"end":video.offset+video.pp.duration(),
				"globalTimeline":globalTimeline,
				"video":video,
			});
		}

		// setup event for playing the global timeline and not

		globalTimeline.on("play",function(){
			// toggle playback button
			$("#playGlobal").hide();
			$("#pauseGlobal").show();
			// check each video whether they should play
			for(var videoname in videos)
			{
				var video = videos[videoname];
				var duration = video.pp.duration();
				var offset = video.offset;
				// >= because 0 and 0
				if((globalTimeline.currentTime() >= offset) && (globalTimeline.currentTime() < offset+duration))
				{
					video.pp.play();
				}
			}
		});

		globalTimeline.on("pause",function(){
			$("#playGlobal").show();
			$("#pauseGlobal").hide();
			for(var videoname in videos)
			{
				var video = videos[videoname];
				video.pp.pause(globalTimeline.currentTime() - video.offset);
				//video.video.pause();
			}
		});


		//adjust the playback pin
		globalTimeline.on("timeupdate",function(){
			if (this.currentTime() > fulldur - 0.5) {
				this.pause(fulldur - 0.5);
			}
			var pct = this.currentTime() / fulldur * 100;
			$("#timeNow").html(cw.sec2time(this.currentTime()));
			$("#timePos").css("left",pct+"%");
			$("#timeNow").css("left",pct+"%");
			// check all video and see whether they should be visible
			// if the current global time is not in the with in this video, hide it
			for(var videoname in videos)
			{
				var videogroup = scene.getObjectByName(videoname);
				var video = videos[videoname];
				if(videogroup!=null)
				{
					if((globalTimeline.currentTime() < video.offset) || (globalTimeline.currentTime() > video.offset+video.pp.duration()))
					{
						videogroup.visible = false;
					}
					else
					{
						videogroup.visible = true;
					}
				}
			}
		});

		// bind the play and pasu button
		cw.ec("#playGlobal",function(){
			if(globalTimeline.currentTime() < fulldur)
			{
				globalTimeline.play();
			}
		});
		cw.ec("#pauseGlobal",function(){
			globalTimeline.pause();
		});
		// bind the space for pressing play or pause
		// or seek

		$(window).keypress(function(e){
			var tag = e.target.tagName.toLowerCase();
			if((tag != "input") && (tag != "textarea"))
			{
				if((e.charCode === 32) || (e.keyCode === 0) || (e.keyCode === 32))
				{
					e.preventDefault();
					//console.log("space "+(new Date()));
					// check should be play or not
					if($("#playGlobal").is(":visible"))
					{
						$("#playGlobal").trigger(cw.ectype);
					}
					else
					{
						$("#pauseGlobal").trigger(cw.ectype);
					}

				}
				else if((e.keyCode === 44) || (e.keyCode === 46))
				{
					// use < and > for seeking
					$("#videoTimeline").trigger({
						"type":"seek",
						"goLeft":(e.keyCode === 44),
						"go":0.01,
					});
				}
			}
		});

		//setup events for draging the playback pin
		var resume = false;// whether to resume after drag
		$("#timePos").draggable({
			"containment": "#videoTimeline",
			"axis": "x",
			"start": function (event, ui) {
				if (globalTimeline.media.paused) {
					resume = false;
				}
				else
				{
					resume = true;
				}
				//console.log(resume);
				globalTimeline.pause();
			},
			"drag": function (event, ui) {
				//console.log(ui.position.left);
				$("#timeNow").css({
					left: ui.position.left
				});
				var pct = ui.position.left / $('#videoTimeline').width();
				$("#timeNow").html(cw.sec2time(fulldur * pct));
			},
			"stop": function (event, ui) {
				var pct = $("#timePos").position().left / $('#videoTimeline').width();
				globalTimeline.currentTime(fulldur * pct);
				if (resume) {
					globalTimeline.play();
				} else {
					// each video seek to here
					for(var videoname in videos)
					{
						var video = videos[videoname];
						video.pp.pause(globalTimeline.currentTime() - video.offset);
					}
				}

			}
		});
		// click the time to seek
		cw.ec("#videoTimeline",function(e){
			console.log("this");
			var clickleft = e.pageX - $('#videoTimeline').offset().left;
			var pct = clickleft / $('#videoTimeline').width();
			seekGlobal(pct);
		});
		$("#videoTimeline").on("seek",function(e){
			var curPct = globalTimeline.currentTime()/fulldur;
			var addOrMinusPct = e.go;
			if(e.goLeft)
			{
				seekGlobal(curPct-addOrMinusPct);
			}
			else
			{
				seekGlobal(curPct+addOrMinusPct);
			}
		});
		function seekGlobal(pct)
		{
			pct = pct<0?0.0:pct;
			pct = pct>1?1.0:pct;
			globalTimeline.currentTime(fulldur * pct);
			if (globalTimeline.media.paused) {
				for(var videoname in videos)
				{
					videos[videoname].pp.currentTime(globalTimeline.currentTime() - videos[videoname].offset);
				}
			}
		}
	}   //video1
        // firstly************** now we add a video into the point cloud space***************
        // we add the video to a cube, and a cone
        var color = colors.pop();
        var [group,videoTexture] = makeVideoGroup("./others.mp4",color);

        // set the video position (camera position) // initial position //blue
		var cameraPos = [0.742089942232, -0.896779140754, 1.23434689738];
		var cameraLook = [0.240069298036,0.065158293585,2.438368721454];


        group.position.set(cameraPos[0]*scaleFactor,cameraPos[1]*scaleFactor,cameraPos[2]*scaleFactor);
        // set the video lookat (angle)
        group.lookAt(new THREE.Vector3(cameraLook[0]*scaleFactor,cameraLook[1]*scaleFactor,cameraLook[2]*scaleFactor));

        scene.add(group);
        // add the control domElement into the panel
        var temp = $('<div class="block">'+
            '<input class="videoname" type="hidden" value="others"></input>'+
            "1.video1: <div class='btn btn-small follow'>跟踪</div> "+
            '<div class="controls"> <div class="btn btn-small btn-info play">播放</div> '+
            '<div class="btn btn-small btn-info pause">暂停</div> '+
            "[<span class='curTime'></span>]"+
            '<br/> <div class="btn btn-small reset">重新开始</div> '+
            '<div class="btn btn-small jump">跳转</div> '+
            '<input style="width:40px" class="input-small to" type="text" placeholder="second"></input> <i class="icon-eye-open showIt"></i> <i class="icon-eye-close hideIt"></i>'+
            "</div> "+
            "<span class='info text-warning'>Loading camera params...</span> "+
            '</div>');
        temp.css({"borderLeftColor":color});
        temp.append(videoTexture.video);
        $("div.main > div.mainControls > div.videoControl").append(temp);

        // show the playing time
        $(videoTexture.video).on("timeupdate",function(){
            var videoname = getVideoname(this.src);
            $("div.main > div.mainControls > div.videoControl > div.block > input[value='"+videoname+"']").parent().find("div.controls > span.curTime").html(this.currentTime.toFixed(2)+"/"+this.duration+"(s)");
        });

        // for controlling the video
        videos["others"] = {
            "video":videoTexture.video,
            "offset":8,
            "videoTexture":videoTexture,
            "paramLoaded":false,// we will use ajax to get the camera param for this video
            "params":null, // list with videotime and camerapos //array of 7 each line

            "lastTarget":null,//the last camera param, including the target videoTime

            "lastLookAt":null,// the last time the video lookAt,since we cant get from 3D object (this is not the camera param, since we move a little every time)

            // the rest is for the tracking thing
            "trackingLoaded":false,
            "tracking":null,
            "pp":Popcorn(videoTexture.video),
            "color":color,
        };
        videos["others"].pp.on("canplaythrough",readyVideo);
        // for use in event
        videos["others"].pp.offset = 8;
        videos["others"].pp.videoname = "others";

        // start to load the video param
        $.get("./video_param/processed_camera_params_video1_sound_original.txt",function(data){
            var videoname = "others";
            videos[videoname]["params"] = parseCameraParam(data);
            videos[videoname]['paramLoaded'] = true;
            $("div.main > div.mainControls > div.videoControl > div.block > input[value='"+videoname+"']").parent().children("span.info").html("");
        });
        // for tracking person's image => id=>imgPath, load in parseTracking

        // load the tracking video param

        $.get("./track_param/video1_3d_position_of_tracked_mans.txt",function(data){
            var videoname = "others";
            trackingVideoPerson2img[videoname] = {};
            videos[videoname]["tracking"] = parseTracking(data,"track_param");
            // go through each person and add their img path
            // write the img path
            for(var personId in videos[videoname]["tracking"])
            {
                trackingVideoPerson2img[videoname][personId] = "./track_param/"+personId+".jpg";
            }
            //console.log(trackingVideoPerson2img);
            videos[videoname]['trackingLoaded'] = true;
        });
            //video2
			// now we add a video into the point cloud space
			// we add the video to a cube, and a cone
		var color = colors.pop();
		var [group,videoTexture] = makeVideoGroup("./92-2_sound_original.mp4",color);

		// set the video position (camera position) // initial position //green
		var cameraPos = [2.51578329891, -0.734912336143, 2.48646818097];
		var cameraLook = [2.522345881342,0.082464033693,2.55366707916];
		/*原greenvar cameraPos = [4.15578329891, -0.634912336143, 1.29646818097];
		var cameraLook = [4.722345881342,0.082464033693,2.35366707916];*/

		group.position.set(cameraPos[0]*scaleFactor,cameraPos[1]*scaleFactor,cameraPos[2]*scaleFactor);
		// set the video lookat (angle)
		group.lookAt(new THREE.Vector3(cameraLook[0]*scaleFactor,cameraLook[1]*scaleFactor,cameraLook[2]*scaleFactor));

		scene.add(group);
		// add the control domElement into the panel
		var temp = $('<div class="block">'+
				'<input class="videoname" type="hidden" value="92-2_sound_original"></input>'+
				"2.video2: <div class='btn btn-small follow'>跟踪</div> "+
				'<div class="controls"> <div class="btn btn-small btn-info play">播放</div> '+
					'<div class="btn btn-small btn-info pause">暂停</div> '+
					"[<span class='curTime'></span>]"+
					'<br/> <div class="btn btn-small reset">重新开始</div> '+
					'<div class="btn btn-small jump">跳转</div> '+
					'<input style="width:40px" class="input-small to" type="text" placeholder="second"></input> <i class="icon-eye-open showIt"></i> <i class="icon-eye-close hideIt"></i>'+
				"</div> "+
				"<span class='info text-warning'>Loading camera params...</span> "+
		'</div>');
		temp.css({"borderLeftColor":color});
		temp.append(videoTexture.video);
		$("div.main > div.mainControls > div.videoControl").append(temp);

		// show the playing time
		$(videoTexture.video).on("timeupdate",function(){
			var videoname = getVideoname(this.src);
			$("div.main > div.mainControls > div.videoControl > div.block > input[value='"+videoname+"']").parent().find("div.controls > span.curTime").html(this.currentTime.toFixed(2)+"/"+this.duration+"(s)");
		});

		// for controlling the video
		videos["92-2_sound_original"] = {
			"video":videoTexture.video,
			"offset":0,
			"videoTexture":videoTexture,
			"paramLoaded":false,// we will use ajax to get the camera param for this video
			"params":null, // list with videotime and camerapos //array of 7 each line

			"lastTarget":null,//the last camera param, including the target videoTime

			"lastLookAt":null,// the last time the video lookAt,since we cant get from 3D object (this is not the camera param, since we move a little every time)

			// the rest is for the tracking thing
			"trackingLoaded":false,
			"tracking":null,
			"pp":Popcorn(videoTexture.video),
			"color":color,
		};
		videos["92-2_sound_original"].pp.on("canplaythrough",readyVideo);
		// for use in event
		videos["92-2_sound_original"].pp.offset = 0;
		videos["92-2_sound_original"].pp.videoname = "92-2_sound_original";

		// start to load the video param
		$.get("./video_param/processed_camera_params_video2_sound_original.txt",function(data){
			var videoname = "92-2_sound_original";
			videos[videoname]["params"] = parseCameraParam(data);
			videos[videoname]['paramLoaded'] = true;
			$("div.main > div.mainControls > div.videoControl > div.block > input[value='"+videoname+"']").parent().children("span.info").html("");
		});
		// for tracking person's image => id=>imgPath, load in parseTracking

		// load the tracking video param
		$.get("./track_param/video2_3d_position_of_tracked_mans.txt",function(data){
			var videoname = "92-2_sound_original";
			trackingVideoPerson2img[videoname] = {};
			videos[videoname]["tracking"] = parseTracking(data,"track_param");
			// go through each person and add their img path
			// write the img path
			for(var personId in videos[videoname]["tracking"])
			{
				trackingVideoPerson2img[videoname][personId] = "./track_param/"+personId+".jpg";
			}
			//console.log(trackingVideoPerson2img);
			videos[videoname]['trackingLoaded'] = true;
		});
			// video3
			// now we add a video into the point cloud space
			// we add the video to a cube, and a cone
		var color = colors.pop();
		var [group,videoTexture] = makeVideoGroup("./113-1_sound.mp4",color);

		// set the video position (camera position) // initial position //yellow
		var cameraPos = [4.15578329891, -0.634912336143, 1.29646818097];
		var cameraLook = [4.722345881342,0.082464033693,2.35366707916];
		/*原yellowvar cameraPos = [2.51578329891, -0.734912336143, 2.48646818097];
		var cameraLook = [2.522345881342,0.082464033693,2.55366707916];*/


		group.position.set(cameraPos[0]*scaleFactor,cameraPos[1]*scaleFactor,cameraPos[2]*scaleFactor);
		// set the video lookat (angle)
		group.lookAt(new THREE.Vector3(cameraLook[0]*scaleFactor,cameraLook[1]*scaleFactor,cameraLook[2]*scaleFactor));

		scene.add(group);
		// add the control domElement into the panel
		var temp = $('<div class="block">'+
				'<input class="videoname" type="hidden" value="113-1_sound"></input>'+
				"3.video3: <div class='btn btn-small follow'>跟踪</div> "+
				'<div class="controls"> <div class="btn btn-small btn-info play">播放</div> '+
					'<div class="btn btn-small btn-info pause">暂停</div> '+
					"[<span class='curTime'></span>]"+
					'<br/> <div class="btn btn-small reset">重新开始</div> '+
					'<div class="btn btn-small jump">跳转</div> '+
					'<input style="width:40px" class="input-small to" type="text" placeholder="second"></input> <i class="icon-eye-open showIt"></i> <i class="icon-eye-close hideIt"></i>'+
				"</div> "+
				"<span class='info text-warning'>Loading camera params...</span> "+
		'</div>');
		temp.css({"borderLeftColor":color});
		temp.append(videoTexture.video);
		$("div.main > div.mainControls > div.videoControl").append(temp);

		// show the playing time
		$(videoTexture.video).on("timeupdate",function(){
			var videoname = getVideoname(this.src);
			$("div.main > div.mainControls > div.videoControl > div.block > input[value='"+videoname+"']").parent().find("div.controls > span.curTime").html(this.currentTime.toFixed(2)+"/"+this.duration+"(s)");
		});

		// for controlling the video
		videos["113-1_sound"] = {
			"video":videoTexture.video,
			"offset":6,
			"videoTexture":videoTexture,
			"paramLoaded":false,// we will use ajax to get the camera param for this video
			"params":null, // list with videotime and camerapos //array of 7 each line

			"lastTarget":null,//the last camera param, including the target videoTime

			"lastLookAt":null,// the last time the video lookAt,since we cant get from 3D object (this is not the camera param, since we move a little every time)

			// the rest is for the tracking thing
			"trackingLoaded":false,
			"tracking":null,
			"pp":Popcorn(videoTexture.video),
			"color":color,
		};
		videos["113-1_sound"].pp.on("canplaythrough",readyVideo);
		// for use in event
		videos["113-1_sound"].pp.offset = 6;
		videos["113-1_sound"].pp.videoname = "113-1_sound";

		// start to load the video param //将function中返回的数据添加到前边的url中
		$.get("./video_param/processed_camera_params_video3_sound_original.txt",function(data){
			var videoname = "113-1_sound";
			videos[videoname]["params"] = parseCameraParam(data);
			videos[videoname]['paramLoaded'] = true;
			$("div.main > div.mainControls > div.videoControl > div.block > input[value='"+videoname+"']").parent().children("span.info").html("");
		});
		// for tracking person's image => id=>imgPath, load in parseTracking

		// load the tracking video param
		$.get("./track_param/video3_3d_position_of_tracked_mans.txt",function(data){
			var videoname = "92-2_sound_original";
			trackingVideoPerson2img[videoname] = {};
			videos[videoname]["tracking"] = parseTracking(data,"track_param");
			// go through each person and add their img path
			// write the img path
			for(var personId in videos[videoname]["tracking"])
			{
				trackingVideoPerson2img[videoname][personId] = "./track_param/"+personId+".jpg";
			}
			//console.log(trackingVideoPerson2img);
			videos[videoname]['trackingLoaded'] = true;
		});
		// hide or show all the project
	cw.ec("div.main > div.mainControls > div.quickLink > div.showProjection",function(){
		for(var videoname in videos)
		{
			// hide the project or show the projrect for all the video
			var videogroup = scene.getObjectByName(videoname);
			if(videogroup != null)
			{
				var projection = videogroup.getObjectByName("projectCube");
				//console.log(projection);
				if(projection != null)
				{
					projection.visible = true;
				}
			}
		}
	});
	cw.ec("div.main > div.mainControls > div.quickLink > div.hideProjection",function(){
		for(var videoname in videos)
		{
			// hide the project or show the projrect for all the video
			var videogroup = scene.getObjectByName(videoname);
			if(videogroup != null)
			{
				var projection = videogroup.getObjectByName("projectCube");
				if(projection != null)
				{
					projection.visible = false;
				}
			}
		}
	});
	// follow the video!
	var lastCameraPos = null;
	var lastControlTarget = null;
	cw.ec("div.main > div.mainControls > div.videoControl > div.block > div.follow",function(){
		if($(this).hasClass("following"))
		{
			$(this).removeClass("following").removeClass("btn-danger").html("follow");
			var videoname = $(this).parent().children("input.videoname").val();
			var videogroup = scene.getObjectByName(videoname);
			if(videogroup!=null)
			{
				videogroup.remove(camera);
			}
			// put everything back
			if(lastCameraPos == null)
			{
				camera.position.set(initialCameraPos.x,initialCameraPos.y,initialCameraPos.z);

				ocontrols.target.set(initialControlTarget.x,initialControlTarget.y,initialControlTarget.z);// has to update here, not the camera
			}
			else
			{
				camera.position.set(lastCameraPos.x,lastCameraPos.y,lastCameraPos.z);

				ocontrols.target.set(lastControlTarget.x,lastControlTarget.y,lastControlTarget.z);// has to update here, not the camera
			}
			ocontrols.update();

		}
		else
		{
			$("div.main > div.mainControls > div.videoControl > div.block > div.follow").removeClass("following").removeClass("btn-danger").html("follow");
			$(this).addClass("following").addClass("btn-danger").html("following");
			// pop the camera out from other place
			for(var videoname in videos)
			{
				group = scene.getObjectByName(videoname);
				if(group != null)
				{
					group.remove(camera);
				}
			}
			var videoname = $(this).parent().children("input.videoname").val();
			var videogroup = scene.getObjectByName(videoname);
			if(videogroup!=null)
			{
				// save the current camera and control target
				lastCameraPos = camera.position.clone();
				lastControlTarget = ocontrols.target.clone();

				videogroup.add(camera);
				camera.position.set(0.0854, 2.0514, -3.0810);
				ocontrols.target.set(0.0871, 0.3194, 18.0535);
				ocontrols.update();
			}
		}
	});
	// these are the individual control
	cw.ec("div.main > div.mainControls > div.videoControl > div.block > div.controls > div.play",function(){
		var videoname = $(this).parent().parent().children("input.videoname").val();
		videos[videoname].video.play();
		// also show the video
		var videogroup = scene.getObjectByName(videoname);
		if(videogroup!=null)
		{
			videogroup.visible = true;
		}
	});
	// hide the video
	cw.ec("div.main > div.mainControls > div.videoControl > div.block > div.controls > i.hideIt",function(){
		var videoname = $(this).parent().parent().children("input.videoname").val();
		var videogroup = scene.getObjectByName(videoname);
		if(videogroup!=null)
		{
			videogroup.visible = false;
		}
	});
	cw.ec("div.main > div.mainControls > div.videoControl > div.block > div.controls > i.showIt",function(){
		var videoname = $(this).parent().parent().children("input.videoname").val();
		var videogroup = scene.getObjectByName(videoname);
		if(videogroup!=null)
		{
			videogroup.visible = true;
		}
	});
	cw.ec("div.main > div.mainControls > div.videoControl > div.block > div.controls > div.reset",function(){
		var videoname = $(this).parent().parent().children("input.videoname").val();
		videos[videoname].video.currentTime = 0.0;
		// also changing the video pos into null as initialized
		videos[videoname]['lastTarget'] = null;
	});
	cw.ec("div.main > div.mainControls > div.videoControl > div.block > div.controls > div.pause",function(){
		var videoname = $(this).parent().parent().children("input.videoname").val();
		videos[videoname].video.pause();
	});
	cw.ec("div.main > div.mainControls > div.videoControl > div.block > div.controls > div.jump",function(){
		var videoname = $(this).parent().parent().children("input.videoname").val();
		var toTime = parseFloat($(this).parent().children("input.to").val());
		if(!isNaN(toTime))
		{
			videos[videoname].video.currentTime = toTime;

			//reset the pos
			videos[videoname]['lastTarget'] = null;

		}

	});


	// camera

	camera.up = new THREE.Vector3( 0, 0, 1 );// in the ply, the up axis is z, while three.js default is y
	//camera.rotation.order = 'ZYX'; // what for? from potree

	// add thing to the DOM
	$("#webgl").append(renderer.domElement);

	// a stat monitoring the performance
	var stats = new Stats();
	stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom
	stats.domElement.style.position = 'relative'; // default absolute
	stats.domElement.style.left = '0px';
	stats.domElement.style.top = '0px';
	$("#stats").append(stats.dom);

	// mouse control of the scene
	var ocontrols = new THREE.OrbitControls(camera, renderer.domElement);
	ocontrols.keyPanSpeed = 20.0;
	ocontrols.enableZoom = false;

	// add a user interface to let user change the js variable for animation
	var controls = {
		"cameraChange":0,
		"sign":1,
	};
	var gui = new dat.GUI({autoPlace:false});
	gui.add(controls,"cameraChange",0,10);
	gui.domElement.id = 'data.gui.control';
	$("#guiControl").append(gui.domElement);

	// control moving in the 3d space
	$(document).keydown(function(e){
		//bind key for moving 3D space
		if((e.keyCode === 38) || (e.keyCode === 40))
		{
			var direction = camera.getWorldDirection();
			// move how much
			var step = 0.3;
			var go = direction.multiplyScalar(step);
			if(e.keyCode === 38)
			{
				camera.position.add(go);
				ocontrols.target.add(go);
			}
			else
			{
				camera.position.sub(go);
				ocontrols.target.sub(go);
			}
			ocontrols.update();
			e.preventDefault();
		}
	});

	// get the current camera localtion and the orbit target
	cw.ec("div.main > div.moreControls > div.getCameraPos",function(){
		$("div.main > div.moreControls > input.cameraPos").val(camera.position.x.toFixed(4)+", "+camera.position.y.toFixed(4)+", "+camera.position.z.toFixed(4)+",orbit target:"+ocontrols.target.x.toFixed(4)+", "+ocontrols.target.y.toFixed(4)+", "+ocontrols.target.z.toFixed(4)+" camera rotation: "+camera.rotation.x.toFixed(4)+", "+camera.rotation.y.toFixed(4)+", "+camera.rotation.z.toFixed(4));
	});

	// set the event control for click things in the 3D space
	cw.ec("#webgl",function(e){
		var winHeight = $("#webgl").height();
		var winWidth = $("#webgl").width();
		var offsetTop = $("#webgl").offset().top;
		var offsetLeft = $("#webgl").offset().left;
		//pageX, pageY, screenX, screenY, clientX and clientY
		var normx = e.pageX - offsetLeft;
		var normy = e.pageY - offsetTop;
		//console.log(normx+" "+ normy); // this hsould be x y in the canvas window;
		mouse = new THREE.Vector2();
		mouse.x = (normx/winWidth)*2-1;
		mouse.y = -(normy/winHeight)*2+1;

		raycaster.setFromCamera(mouse,camera);
		var intersects = raycaster.intersectObjects(scene.children,true);// true is needed for grouped object
		//[ { distance, point, face, faceIndex, indices, object }, ... ]
		// the first one should be the target
		// point is a Vector3

		if(intersects.length > 0)
		{
			var selected = intersects[0]; // the closest one to the camera
			//console.log(selected.object.name);
			$("div.main > div.moreControls > input.clickPoint").val(selected.point.x.toFixed(4)+", "+selected.point.y.toFixed(4)+", "+selected.point.z.toFixed(4));
			/*
			var geometry = new THREE.SphereGeometry(0.2, 20, 20, 0, Math.PI * 2, 0, Math.PI * 2);
			var material = new THREE.MeshNormalMaterial();
			var ball = new THREE.Mesh(geometry, material);

			ball.position.copy( selected.point );

			scene.add( ball );
			*/

		}
		else
		{
			$("div.main > div.moreControls > input.clickPoint").val("");
		}

	});
	// bind kind for going foward or backward

	$(document).delegate("#webgl","dblclick",function(e){
		var winHeight = $("#webgl").height();
		var winWidth = $("#webgl").width();
		var offsetTop = $("#webgl").offset().top;
		var offsetLeft = $("#webgl").offset().left;
		//pageX, pageY, screenX, screenY, clientX and clientY
		var normx = e.pageX - offsetLeft;
		var normy = e.pageY - offsetTop;
		//console.log(normx+" "+ normy); // this hsould be x y in the canvas window;
		mouse = new THREE.Vector2();
		mouse.x = (normx/winWidth)*2-1;
		mouse.y = -(normy/winHeight)*2+1;

		raycaster.setFromCamera(mouse,camera);
		var intersects = raycaster.intersectObjects(scene.children,true);// true is needed for grouped object
		//[ { distance, point, face, faceIndex, indices, object }, ... ]
		// the first one should be the target
		// point is a Vector3

		if(intersects.length > 0)
		{
			var I = intersects[0].point; // the closest one to the camera
			// this is the distance between camera and you orbit, so when fly to the point you won;t be exactly at the point but a step back
			var camTargetDistance = camera.position.distanceTo(ocontrols.target);

			var vector = new THREE.Vector3( mouse.x, mouse.y, 0.5 );
			vector.unproject(camera);

			var direction = vector.sub(camera.position).normalize();
			var ray = new THREE.Ray(camera.position, direction);


			var targetRadius = Math.min(camTargetDistance, 5);

			var d = camera.getWorldDirection().multiplyScalar(-1);
			var cameraTargetPosition = new THREE.Vector3().addVectors(I, d.multiplyScalar(targetRadius));
			var controlsTargetPosition = I;


			var animationDuration = 600;

			var easing = TWEEN.Easing.Quartic.Out;

			ocontrols.enabled = false;

			// animate position
			var tween = new TWEEN.Tween(camera.position).to(cameraTargetPosition, animationDuration);
			tween.easing(easing);
			tween.start();

			// animate target
			var tween = new TWEEN.Tween(ocontrols.target).to(I, animationDuration);
			tween.easing(easing);
			tween.onComplete(function(){
				ocontrols.enabled = true;

			});
			tween.start();
		}
		else
		{

		}

	});


	// set the initial looking point and direction
	var initialCameraPos = new THREE.Vector3(25.7847, -6.5853, 14.1481);
	var initialControlTarget = new THREE.Vector3(23.1854, -6.1001, 13.4477);
	camera.position.set(initialCameraPos.x,initialCameraPos.y,initialCameraPos.z);
	//camera.rotation.set( 0.9114, -0.9240, -0.5539);
	//camera.lookAt(new THREE.Vector3( 55.4319, 13.1690, 50.4633)); // used the "last click point"

	ocontrols.target.set(initialControlTarget.x,initialControlTarget.y,initialControlTarget.z);// has to update here, not the camera
	ocontrols.update();

	//var refreshStep = 0.02;// in seconds //0.02 is about 60fps // now we estimate this based on fps
	var preTime = new Date();

	function draw()
	{
		stats.begin();

		camera.position.x += controls.sign*controls.cameraChange;
		if((camera.position.x > 100) || (camera.position.x < -100))
		{
			//console.log(camera.position.x);
			controls.sign = -controls.sign;
		}
		// estimating the fpsnow
		var nowTime = new Date();
		var fps = 1000/(nowTime - preTime);
		fps = isFinite(fps)?fps:60.0;
		preTime = nowTime;
		var refreshStep = 1.0/fps;
		TWEEN.update();

		// update the video!
		// the video position and the tracking
		for(var videoname in videos)
		{
			videos[videoname]['videoTexture'].update();
			var video = videos[videoname].video;
			var curVideoTime = video.currentTime;

			if(videos[videoname]['paramLoaded']) // now that we have all the camera position
			{
				// check if the video is paused
				if((curVideoTime <= 0) || (video.paused) || (video.ended))
				{
					continue;
				}

				// check through the list to get the correct position
					// a array of 6 [cam_xyz,cam_look_xyz]
				//return the target pos based on curVideoTime <= targetVideoTime
				var [targetVideoTime,newPos] = getCameraPos(videos[videoname]['params'],curVideoTime);

				var lastTargetVideoTime = null;
				if(videos[videoname]['lastTarget'] != null)
					lastTargetVideoTime = videos[videoname]['lastTarget'][6];

				if(newPos == null)
				{
					console.log("camera pos not found. cur video time:"+curVideoTime);
				}
				else if(targetVideoTime < curVideoTime)
				{
					// could be the video have used all available camera param
				}
				else
				{
					var group = scene.getObjectByName(videoname);
					if(group == null)
					{
						console.log("error,group not found in scene:"+videoname);
					}
					else
					{

						// initial
						if(videos[videoname]['lastTarget'] == null)
						{
							videos[videoname]['lastTarget'] = [newPos[0]*scaleFactor,newPos[1]*scaleFactor,newPos[2]*scaleFactor,newPos[3]*scaleFactor,newPos[4]*scaleFactor,newPos[5]*scaleFactor,targetVideoTime];
						}


						if(targetVideoTime == lastTargetVideoTime)
						{
							// the target is the same as last time, then we still moving to it
							var timeDiff = targetVideoTime - curVideoTime;
							var stepToFinish = parseInt(timeDiff/refreshStep);
							// we divide the current point to the target point(both camera pos and lookAt) into steps
							if(stepToFinish <= 1)
							{
								//do nothing

							}
							else
							{
								// camera pos
								//var [posStepX,posStepY,posStepZ] = [(newPos[0]*scaleFactor - group.position.x)/stepToFinish,(newPos[1]*scaleFactor - group.position.y)/stepToFinish,(newPos[2]*scaleFactor - group.position.z)/stepToFinish];
								var [posStepX,posStepY,posStepZ] = [(videos[videoname]['lastTarget'][0] - group.position.x)/stepToFinish,(videos[videoname]['lastTarget'][1] - group.position.y)/stepToFinish,(videos[videoname]['lastTarget'][2] - group.position.z)/stepToFinish];
								group.position.set(group.position.x+posStepX,group.position.y+posStepY,group.position.z+posStepZ);

								// lookAt point
									// we need last LookAt since you can't get this in 3D object
								var lastLookAt = videos[videoname]['lastLookAt'];
								var [newLookX,newLookY,newLookZ] = [
									lastLookAt[0]+(videos[videoname]['lastTarget'][3] - lastLookAt[0])/stepToFinish,
									lastLookAt[1]+(videos[videoname]['lastTarget'][4] - lastLookAt[1])/stepToFinish,
									lastLookAt[2]+(videos[videoname]['lastTarget'][5] - lastLookAt[2])/stepToFinish
								];
								group.lookAt(new THREE.Vector3(newLookX,newLookY,newLookZ));

								//lookAt needs to remember
								videos[videoname]['lastLookAt'] = [newLookX,newLookY,newLookZ];
							}
						}else
						{
							// now the target is not the old target, we will jump to the old target, and start going to the new target in the next loop
								//1. the camera pos
							group.position.set(videos[videoname]['lastTarget'][0],videos[videoname]['lastTarget'][1],videos[videoname]['lastTarget'][2]);
								//2. the lookAt.
							group.lookAt(new THREE.Vector3(videos[videoname]['lastTarget'][3],videos[videoname]['lastTarget'][4],videos[videoname]['lastTarget'][5]));

							videos[videoname]['lastLookAt'] = [videos[videoname]['lastTarget'][3],videos[videoname]['lastTarget'][4],videos[videoname]['lastTarget'][5]];
							// the lastTarget is the currect target now.
							videos[videoname]['lastTarget'] = [newPos[0]*scaleFactor,newPos[1]*scaleFactor,newPos[2]*scaleFactor,newPos[3]*scaleFactor,newPos[4]*scaleFactor,newPos[5]*scaleFactor,targetVideoTime];
						}
					}
				}
			}
			// the tracking thing
			if(videos[videoname]['trackingLoaded'])
			{
				// go though each person
				var videogroup = scene.getObjectByName(videoname); // the video
				for(var personId in videos[videoname]['tracking'])
				{
					var personObjectId = "person"+personId;
					var [targetVideoTime,newPos,lastPos] = getTrackingPos(videos[videoname]['tracking'][personId]['posList'],curVideoTime);

					// get the last target
					var lastTarget = videos[videoname]['tracking'][personId]['lastTarget'];
					var lastTargetVideoTime = null;
					if(lastTarget != null)
						lastTargetVideoTime = lastTarget[3];

					var person = scene.getObjectByName(personObjectId);
					// the video is during earlier than first person pos and last pos
					if(newPos == null)
					{
						// clean the person existsed
						if(person != null)
						{
							person.visible = false;
						}
					}
					else
					{
						// the video time is inside where the person is present

						// initial
						if(lastTarget == null)
						{
							videos[videoname]['tracking'][personId]['lastTarget'] = [newPos[0]*scaleFactor,newPos[1]*scaleFactor,newPos[2]*scaleFactor,targetVideoTime];
							lastTarget = videos[videoname]['tracking'][personId]['lastTarget'];
						}
						if(person == null) // make the person object the first time
						{
							person = makePerson(personColors.pop(),personObjectId,trackingVideoPerson2img[videoname][personId]);
							person.position.set(lastPos[0]*scaleFactor,lastPos[1]*scaleFactor,lastPos[2]*scaleFactor); // initial position is the first person position
							person.lookAt(new THREE.Vector3(videogroup.position.x,videogroup.position.y,person.position.z));
							scene.add(person);
						}
						else
						{
							person.visible = true;
						}

						if(targetVideoTime == lastTargetVideoTime)
						{
							// the target is the same as last time, then we still moving to it
							var timeDiff = targetVideoTime - curVideoTime;
							var stepToFinish = parseInt(timeDiff/refreshStep);
							// we divide the current point to the target point(both camera pos and lookAt) into steps
							if(stepToFinish <= 1)
							{
								//do nothing

							}
							else
							{

								var [posStepX,posStepY,posStepZ] = [(lastTarget[0] - person.position.x)/stepToFinish,(lastTarget[1] - person.position.y)/stepToFinish,(lastTarget[2] - person.position.z)/stepToFinish];
								person.position.set(person.position.x+posStepX,person.position.y+posStepY,person.position.z+posStepZ);

							}
						}else
						{
							// now the target is not the old target, we will jump to the old target, and start going to the new target in the next loop
								//1. the camera pos
							person.position.set(lastTarget[0],lastTarget[1],lastTarget[2]);
							// the lastTarget is the currect target now.
							videos[videoname]['tracking'][personId]['lastTarget'] = [newPos[0]*scaleFactor,newPos[1]*scaleFactor,newPos[2]*scaleFactor,targetVideoTime];
						}

					}
				}
			}
		}

		renderer.render(sceneBG,backgroundCamera); // the background
		renderer.render(scene,camera);

		stats.end();
		id = window.requestAnimationFrame(draw);
	}
	draw();


}
$(document).ready(function(){
	init();
});
// show or close single video control
cw.ec("#singleVideoControls",function(){
	if($(this).hasClass("shown"))
	{
		$(this).removeClass("shown").removeClass("icon-eye-open").addClass("hidden").addClass("icon-eye-close");
		$("div.main > div.mainControls > div.videoControl > div.block > div.controls").hide();
	}
	else
	{
		$(this).removeClass("hidden").removeClass("icon-eye-close").addClass("shown").addClass("icon-eye-open");
		$("div.main > div.mainControls > div.videoControl > div.block > div.controls").show();
	}
});
</script>
<style type="text/css">
/*style for the timeline control*/
#videoTimeline{
	cursor:pointer;
	position:relative;
	background-color:rgb(240,240,240);
	margin-bottom:25px;/*make place for time display*/
}
#videoTimeline > div.mainTimeline{
	background:url('./img/reel.png') top left repeat-x;
	height:5px;
	width:100%;
}
#videoTimeline > #timePos{
	position:absolute;
	left:0%;
	background-color:rgba(255,0,0,0.5);
	z-index:999;
	width:4px;
	height:100%;
	bottom:0;
}
#videoTimeline > #timeNow{
	position:absolute;
	margin-left:-30px;
	width:60px;
	height:20px;
	font-size:0.7em;
	background-color:black;
	color:white;
	font-weight:bold;
	z-index:999;
	text-align:center;
	bottom:-19px;
	left:0%;
}
#videoTimeline > div.videos > div.block{
	background-color:rgb(240,240,240);
	border-bottom:3px silver solid;
	height:30px;
	position:relative;
}
#videoTimeline > div.videos > div.block > div.video{
	position:absolute;
	top:0;left:0;
	height:100%;
	text-align:center;
	font-size:0.8em;
}
div.main > div.mainControls > div.globalControl{
	margin:5px;
	background-color:#c8c8c8;
	text-align:center;
	padding:2px 0;
}
div.main > div.mainControls > div.globalControl > i{
	cursor:pointer;
}
</style>
<div id="cHtml3d">
	<div class="warning" style="margin:0px 0;border-bottom:1px silver solid;font-size:1.2em;color:gray;font-weight:bold;text-align:center;">
		本系统使用波士顿爆炸案为demo作为展示
	</div>
	<div id="webgl" style="height:650px;position:fixed;width:82%;top:60px;left:61%;margin-left:-400px">
	<!--<canvas width="1100" height="650" style="/* width: 1100px; */height: 650px;"></canvas>--></div>
	<div class="main" style="margin:0 1100px 0 0;padding-left:5px;">

		<div class="mainControls">
			<div class="quickLink" style="text-align:center;padding:5px;">
				<!--<a class="btn btn-small btn-success" href="/daisy/index.php/application/cPointCloudVideo?project=0.5" target="_self">Show Projection</a>
				<a class="btn btn-small btn-success" href="/daisy/index.php/application/cPointCloudVideo?project=0" target="_self">No Projection</a>-->
				<div class="btn btn-small btn-success showProjection">展示投影</div>
				<div class="btn btn-small hideProjection">隐藏投影</div>
			</div>
			<!-- for the loading of ply file -->
			<div class="progress progress-striped active" id="loadProgress" style="display: none;">
				<div class="bar" style="width: 100%;">100.000%</div>
			</div>
			<div class="videoTimeline" id="videoTimeline">
				<div id="timePos"></div>
				<div id="timeNow">00:00:00.0</div>
				<div class="videos">
				<div style="display: none"><div class="video" title="92-2_sound_original" style="width: 99.723%; left: 0%; background-color: blue;"></div></div><div style="display: none"><div class="video" title="113-1_sound" style="width: 24.3279%; left: 13.2947%; background-color: green;"></div></div></div>
				<div class="mainTimeline"></div>
			<div></div></div>
			<div class="globalControl">
				<i class="icon-play" id="playGlobal"></i>
				<i class="icon-pause" id="pauseGlobal" style="display:none"></i>
				<i class="icon-eye-close hidden" id="singleVideoControls"></i>
				<span class="text-info" style="font-size:0.8em">按下“空格”来选择播放或暂停, <br>拖动来选择快进或快退</span>
			</div>
			<div class="videoControl">

			<div class="block" style="border-left-color: blue;display: none;"><input class="videoname" type="hidden" value="92-2_sound_original">1.92-2_sound_original: <div class="btn btn-small follow following btn-danger">跟踪</div> <div class="controls"> <div class="btn btn-small btn-info play">播放</div> <div class="btn btn-small btn-info pause">暂停</div> [<span class="curTime">0.00/360.047(s)</span>]<br> <div class="btn btn-small reset">重新开始</div> <div class="btn btn-small jump">跳转</div> <input style="width:40px" class="input-small to" type="text" placeholder="second"> <i class="icon-eye-open showIt"></i> <i class="icon-eye-close hideIt"></i></div> <span class="info text-warning"></span> <video width="320" height="200" src="./92-2_sound_original.mp4"></video></div><div class="block" style="border-left-color: green;display: none;"><input class="videoname" type="hidden" value="113-1_sound">2.113-1_sound: <div class="btn btn-small follow">跟踪</div> <div class="controls"> <div class="btn btn-small btn-info play">播放</div> <div class="btn btn-small btn-info pause">暂停</div> [<span class="curTime"></span>]<br> <div class="btn btn-small reset">重新开始</div> <div class="btn btn-small jump">跳转</div> <input style="width:40px" class="input-small to" type="text" placeholder="second"> <i class="icon-eye-open showIt"></i> <i class="icon-eye-close hideIt"></i></div> <span class="info text-warning"></span> <video width="320" height="200" src="./113-1_sound.mp4"></video></div></div>
		</div>
		<div id="stats" style="margin-bottom:20px"><div style="position: relative; top: 0px; left: 0px; cursor: pointer; opacity: 0.9; z-index: 10000;"><canvas width="80" height="48" style="width: 80px; height: 48px; display: block;"></canvas><canvas width="80" height="48" style="width: 80px; height: 48px; display: none;"></canvas><canvas width="80" height="48" style="width: 80px; height: 48px; display: none;"></canvas></div></div>
		<div id="guiControl" style="margin-bottom:20px"><div class="dg main" id="data.gui.control" style="width: 245px;"><ul><li class="cr number has-slider"><div><span class="property-name">cameraChange</span><div class="c"><div><input type="text"></div><div class="slider"><div class="slider-fg" style="width: 0%;"></div></div></div></div></li></ul><div class="close-button" style="width: 245px;">Close Controls</div></div></div>
		<div class="moreControls" style="padding:5px;line-height:30px">
			<div class="btn btn-small getCameraPos">获取当前摄影位置</div>:
			<input class="cameraPos input-xxlarge" style="width:280px;" type="text">
			<br>
			最后一次点击位置: <input class="clickPoint input-medium" type="text">
		</div>
	</div>
</div><!--
	a Chun Wai Leong's production
	contact: 2546858999@qq.com
-->

</body></html>